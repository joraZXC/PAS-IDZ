{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>СаСЗМ — Оператор</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
        body{min-height:100vh;background:linear-gradient(135deg,#0f2027 0%,#203a43 50%,#2c5364 100%);color:#e0e0e0;display:flex;flex-direction:column;}
        .container{display:flex;flex:1;min-height:100vh;}
        .sidebar{width:280px;background:rgba(15,32,39,.98);backdrop-filter:blur(12px);border-right:1px solid rgba(255,255,255,.1);padding:30px 20px;display:flex;flex-direction:column;height:100vh;position:sticky;top:0;z-index:100;box-shadow:5px 0 20px rgba(0,0,0,.3);transition:transform .3s ease;}
        .content{flex:1;padding:20px;overflow-y:auto;}
        .mobile-menu-btn{display:none;background:none;border:none;color:#e0e0e0;font-size:24px;cursor:pointer;padding:10px;position:fixed;top:15px;left:15px;z-index:1001;}
        @media(max-width:992px){
            .sidebar{position:fixed;left:0;top:0;height:100vh;transform:translateX(-100%);z-index:1000;}
            .sidebar.open{transform:translateX(0);}
            .mobile-menu-btn{display:block;}
            .content{padding:15px;}
        }
        @media(max-width:600px){
            .header-bar{flex-direction:column;align-items:flex-start;}
            .header-actions{margin-top:10px;width:100%;justify-content:space-between;}
        }
        .logo{display:flex;align-items:center;gap:12px;margin-bottom:40px;padding:0 10px;}
        .logo-icon{width:50px;height:50px;background:radial-gradient(circle at 30% 30%,#a0aec0,#4a5568);border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 6px 20px rgba(0,0,0,.4),inset 0 2px 6px rgba(255,255,255,.2);position:relative;overflow:hidden;border:2px solid #2d3748;}
        .logo-icon::before{content:'Æ';font-family:'Orbitron',sans-serif;font-size:30px;font-weight:700;color:transparent;background:linear-gradient(135deg,#e0e0e0 0%,#fff 30%,#a0aec0 70%,#718096 100%);-webkit-background-clip:text;background-clip:text;text-shadow:0 2px 4px rgba(0,0,0,.3);}
        .logo-icon::after{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(115deg,transparent 30%,rgba(255,255,255,.15) 45%,rgba(255,255,255,.3) 50%,rgba(255,255,255,.15) 55%,transparent 70%);transform:rotate(30deg);animation:shine 3s infinite;}
        @keyframes shine{0%{transform:translateX(-100%) rotate(30deg);}100%{transform:translateX(100%) rotate(30deg);}}
        .logo h1{font-size:18px;font-weight:600;color:#e0e0e0;}
        .logo h1 span{display:block;font-size:12px;color:#a0aec0;font-weight:400;}
        .nav-menu{flex:1;display:flex;flex-direction:column;gap:8px;margin-bottom:30px;}
        .nav-item{display:flex;align-items:center;gap:12px;padding:14px 16px;border-radius:12px;color:#a0aec0;font-size:15px;font-weight:500;cursor:pointer;transition:all .3s ease;position:relative;}
        .nav-item:hover{background:rgba(74,144,226,.15);color:#e0e0e0;}
        .nav-item.active{background:linear-gradient(90deg,#4a90e2,#357abd);color:#fff;font-weight:600;box-shadow:0 4px 15px rgba(74,144,226,.3);}
        .nav-item .icon{width:20px;height:20px;background:currentColor;mask-size:contain;mask-repeat:no-repeat;mask-position:center;-webkit-mask-size:contain;-webkit-mask-repeat:no-repeat;-webkit-mask-position:center;}
        .icon-rolls{mask-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 18H5V5h14v15zM7 7h2v2H7V7zm0 4h2v2H7v-2zm0 4h2v2H7v-2zm4-8h2v2h-2V7zm0 4h2v2h-2v-2zm0 4h2v2h-2v-2zm4-8h2v2h-2V7zm0 4h2v2h-2v-2zm0 4h2v2h-2v-2z"/></svg>');}
        .icon-report{mask-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14h-4v-4h4v4zm0-6h-4V7h4v4zm5 6h-3v-4h3v4zm0-6h-3V7h3v4z"/></svg>');}
        .icon-downtime{mask-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M13 3h-2v2h2V3zm4.83 2.17l-1.41 1.41 1.41 1.41 1.41-1.41-1.41-1.41zM19 11h2v2h-2v-2zm-8 8c-2.76 0-5-2.24-5-5s2.24-5 5-5v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v2zm7-8h2v2h-2v-2zm-7-6h-2v2h2V5zm-4.83 2.17l-1.41 1.41L5.59 7.17 7 5.76 5.59 4.34zM5 11H3v2h2v-2zm0 8h2v2H5v-2zm0-8h2v2H5v-2z"/></svg>');}
        .icon-logout{mask-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.59L17 17l5-5-5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>');}
        .user-section{margin-top:auto;padding:20px 16px;border-top:1px solid rgba(255,255,255,.1);display:flex;align-items:center;gap:12px;color:#a0aec0;font-size:14px;}
        .user-section .avatar{width:40px;height:40px;background:#4a90e2;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#fff;font-size:16px;}
        .header-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px;padding-bottom:15px;border-bottom:1px solid rgba(255,255,255,.1);flex-wrap:wrap;gap:10px;}
        .page-title{font-size:22px;font-weight:600;color:#e0e0e0;}
        .header-actions{display:flex;align-items:center;gap:10px;}
        .timer{background:rgba(74,144,226,.2);padding:6px 12px;border-radius:20px;font-size:13px;font-weight:600;color:#a0aec0;}
        .section{display:none;animation:fadeIn .4s ease;}
        .section.active{display:block;}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
        .card{background:rgba(15,32,39,.95);border-radius:16px;padding:20px;margin-bottom:20px;box-shadow:0 10px 25px rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.1);}
        .card-title{font-size:17px;color:#cbd5e0;display:flex;align-items:center;gap:8px;margin-bottom:15px;}
        .card-title::before{content:'';width:6px;height:6px;background:#4a90e2;border-radius:50%;}
        .form-group{margin-bottom:16px;}
        .form-group label{display:block;margin-bottom:8px;color:#cbd5e0;font-size:14px;}
        .form-group input,.form-group select,.form-group textarea{
            width:100%;padding:10px 12px;background:rgba(45,55,72,.6);border:1px solid rgba(100,116,139,.4);border-radius:10px;color:#e0e0e0;font-size:13.5px;transition:border .3s;
        }
        .form-group input:focus,.form-group select:focus,.form-group textarea:focus{
            border-color:#4a90e2;outline:none;
        }
        .form-group input:disabled{background:rgba(45,55,72,.4);color:#a0aec0;}
        .form-group textarea{resize:vertical;min-height:100px;}
        .btn-primary{background:#4a90e2;color:#fff;border:none;padding:10px 20px;border-radius:20px;font-weight:600;font-size:13px;cursor:pointer;transition:all .3s;box-shadow:0 4px 15px rgba(74,144,226,.3);}
        .btn-primary:hover{background:#357abd;transform:translateY(-2px);}
        .warehouse-list{margin-top:10px;}
        .warehouse-group{margin-bottom:20px;}
        .warehouse-title{font-size:15px;color:#cbd5e0;margin-bottom:10px;font-weight:600;}
        .warehouse-item{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px dashed rgba(100,116,139,.3);font-size:13.5px;color:#e0e0e0;}
        .warehouse-item:last-child{border-bottom:none;}
    </style>
</head>
<body>
    <div class="mobile-menu-btn" onclick="toggleSidebar()">☰</div>
    <div class="container">
        <!-- БОКОВОЕ МЕНЮ -->
        <aside class="sidebar" id="sidebar">
            <div class="logo">
                <div class="logo-icon"></div>
                <div><h1>СаСЗМ<br><span>Система слежения за металлом</span></h1></div>
            </div>
            <nav class="nav-menu">
                <div class="nav-item active" data-page="rolls"><div class="icon icon-rolls"></div><span>Рулоны</span></div>
                <div class="nav-item" data-page="report"><div class="icon icon-report"></div><span>Сменный рапорт</span></div>
                <div class="nav-item" data-page="downtime"><div class="icon icon-downtime"></div><span>Простои и брак</span></div>
            </nav>
            <div class="user-section">
                <div class="avatar">{{ request.user.username|slice:":2"|upper }}</div>
                <div>
                    <div style="font-weight:600;color:#e0e0e0;">Оператор</div>
                    <div style="font-size:13px;color:#a0aec0;">{{ request.user.get_full_name|default:request.user.username }}</div>
                </div>
            </div>

            <!-- ВЫХОД — РАБОЧАЯ ФОРМА -->
            {% csrf_token %}
            <div class="nav-item" style="margin-top:15px;color:#feb2b2;cursor:pointer;" onclick="logout()">
                <div class="icon icon-logout"></div><span>Выход</span>
            </div>
        </aside>

        <!-- КОНТЕНТ -->
        <main class="content">
            <!-- РУЛОНЫ -->
            <div class="section active" id="rolls">
                <header class="header-bar">
                    <h1 class="page-title">Рулоны и склады</h1>
                    <div class="header-actions"><div class="timer">Сегодня: {{ current_date }}</div></div>
                </header>

                <div class="card">
                    <div class="card-title">Взять рулон на производство</div>
                    <form>
                        <div class="form-group">
                            <label>Со склада</label>
                            <select required>
                                <option value="">Выберите склад</option>
                                <option>Склад №1 (После плавки)</option>
                                <option>Склад №2 (После прокатки)</option>
                                <option>Склад №3 (Термообработка)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ID рулона</label>
                            <input type="text" placeholder="RU-2025-101" required />
                        </div>
                        <button type="submit" class="btn-primary">Взять на агрегат</button>
                    </form>
                </div>

                <div class="card">
                    <div class="card-title">Разместить рулон после производства</div>
                    <form>
                        <div class="form-group">
                            <label>На склад</label>
                            <select required>
                                <option value="">Выберите склад</option>
                                <option>Склад №2 (После прокатки)</option>
                                <option>Склад №3 (Термообработка)</option>
                                <option>Склад №4 (Готовая продукция)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ID рулона</label>
                            <input type="text" placeholder="RU-2025-090" required />
                        </div>
                        <div class="form-group">
                            <label>Вес рулона (т)</label>
                            <input type="number" step="0.1" required />
                        </div>
                        <button type="submit" class="btn-primary">Разместить на склад</button>
                    </form>
                </div>

                <div class="card">
                    <div class="card-title">Текущие склады</div>
                    <div class="warehouse-list">
                        <div class="warehouse-group">
                            <div class="warehouse-title">Склад №1 (После плавки)</div>
                            <div class="warehouse-item"><span>RU-2025-101</span><span>22.5 т</span></div>
                            <div class="warehouse-item"><span>RU-2025-102</span><span>21.8 т</span></div>
                        </div>
                        <div class="warehouse-group">
                            <div class="warehouse-title">Склад №4 (Готовая продукция)</div>
                            <div class="warehouse-item"><span>RU-2025-060</span><span>19.5 т</span></div>
                            <div class="warehouse-item"><span>RU-2025-061</span><span>19.7 т</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- СМЕННЫЙ РАПОРТ -->
            <div class="section" id="report">
                <header class="header-bar">
                    <h1 class="page-title">Сменный рапорт</h1>
                    <div class="header-actions"><div class="timer">{{ current_date }}</div></div>
                </header>
                <div class="card">
                    <form>
                        <div class="form-group">
                            <label>Дата и смена</label>
                            <input type="text" value="{{ current_date }} — Дневная смена" disabled />
                        </div>
                        <div class="form-group">
                            <label>Агрегат</label>
                            <select required>
                                <option>Агрегат 1</option>
                                <option>Агрегат 2</option>
                                <option>Агрегат 3</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Количество произведённых рулонов</label>
                            <input type="number" required />
                        </div>
                        <div class="form-group">
                            <label>Брак (%)</label>
                            <input type="number" step="0.1" />
                        </div>
                        <div class="form-group">
                            <label>Простои (мин)</label>
                            <input type="number" />
                        </div>
                        <div class="form-group">
                            <label>Комментарий</label>
                            <textarea rows="4" placeholder="Замечания..."></textarea>
                        </div>
                        <button type="submit" class="btn-primary">Отправить рапорт</button>
                    </form>
                </div>
            </div>

            <!-- ПРОСТОИ И БРАК -->
            <div class="section" id="downtime">
                <header class="header-bar">
                    <h1 class="page-title">Простои и брак</h1>
                    <div class="header-actions"><div class="timer">{{ current_date }}</div></div>
                </header>

                <div class="card">
                    <div class="card-title">Зафиксировать простой</div>
                    <form>
                        <div class="form-group">
                            <label>Причина</label>
                            <select required>
                                <option>Ожидание материала</option>
                                <option>Тех. неисправность</option>
                                <option>Смена инструмента</option>
                                <option>Перерыв</option>
                                <option>Другое</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Начало</label>
                            <input type="datetime-local" required />
                        </div>
                        <div class="form-group">
                            <label>Окончание</label>
                            <input type="datetime-local" required />
                        </div>
                        <div class="form-group">
                            <label>Комментарий</label>
                            <textarea rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn-primary">Зафиксировать</button>
                    </form>
                </div>

                <div class="card">
                    <div class="card-title">Зафиксировать брак</div>
                    <form>
                        <div class="form-group">
                            <label>ID рулона</label>
                            <input type="text" placeholder="RU-2025-090" required />
                        </div>
                        <div class="form-group">
                            <label>Тип брака</label>
                            <select required>
                                <option>Поверхностный дефект</option>
                                <option>Толщина вне допуска</option>
                                <option>Хим. состав</option>
                                <option>Другое</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Объём брака (т)</label>
                            <input type="number" step="0.1" required />
                        </div>
                        <div class="form-group">
                            <label>Описание</label>
                            <textarea rows="4" required></textarea>
                        </div>
                        <button type="submit" class="btn-primary">Зафиксировать</button>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.querySelectorAll('.nav-item[data-page]').forEach(item => {
            item.addEventListener('click', () => {
                const page = item.getAttribute('data-page');
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
                document.getElementById(page).classList.add('active');
                if (window.innerWidth <= 992) document.getElementById('sidebar').classList.remove('open');
            });
        });

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // РАБОЧАЯ ФУНКЦИЯ ВЫХОДА
        function logout() {
            if (confirm('Выйти из системы?')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = "{% url 'logout' %}";

                const csrf = document.createElement('input');
                csrf.type = 'hidden';
                csrf.name = 'csrfmiddlewaretoken';
                csrf.value = document.querySelector('[name=csrfmiddlewaretoken]').value;

                form.appendChild(csrf);
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
</body>
</html>