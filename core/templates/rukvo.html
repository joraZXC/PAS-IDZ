{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Руководство — СаСЗМ</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
        body{min-height:100vh;background:linear-gradient(135deg,#0f2027 0%,#203a43 50%,#2c5364 100%);color:#e0e0e0;display:flex;flex-direction:column;}
        .container{display:flex;flex:1;min-height:100vh;}
        .sidebar{width:280px;background:rgba(15,32,39,.98);backdrop-filter:blur(12px);border-right:1px solid rgba(255,255,255,.1);padding:30px 20px;display:flex;flex-direction:column;height:100vh;position:sticky;top:0;z-index:100;box-shadow:5px 0 20px rgba(0,0,0,.3);transition:transform .3s ease;}
        .content{flex:1;padding:20px;overflow-y:auto;}
        .mobile-menu-btn{display:none;background:none;border:none;color:#e0e0e0;font-size:24px;cursor:pointer;padding:10px;position:fixed;top:15px;left:15px;z-index:1001;}
        @media(max-width:992px){
            .sidebar{position:fixed;left:0;top:0;height:100vh;transform:translateX(-100%);z-index:1000;}
            .sidebar.open{transform:translateX(0);}
            .mobile-menu-btn{display:block;}
            .content{padding:15px;}
        }
        @media(max-width:600px){
            .header-bar{flex-direction:column;align-items:flex-start;}
            .header-actions{margin-top:10px;width:100%;justify-content:space-between;}
        }
        .logo{display:flex;align-items:center;gap:16px;margin-bottom:40px;padding:0 10px;}
        .logo-img{width:56px;height:56px;object-fit:contain;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.4);border:2px solid rgba(255,255,255,.1);}
        .logo h1{font-size:18px;font-weight:600;color:#e0e0e0;}
        .logo h1 span{display:block;font-size:12px;color:#a0aec0;font-weight:400;margin-top:2px;}
        .nav-menu{flex:1;display:flex;flex-direction:column;gap:8px;margin-bottom:30px;}
        .nav-item{display:flex;align-items:center;gap:12px;padding:14px 16px;border-radius:12px;color:#a0aec0;font-size:15px;font-weight:500;cursor:pointer;transition:all .3s ease;}
        .nav-item:hover{background:rgba(74,144,226,.15);color:#e0e0e0;}
        .nav-item.active{background:linear-gradient(90deg,#4a90e2,#357abd);color:#fff;font-weight:600;box-shadow:0 4px 15px rgba(74,144,226,.3);}
        .nav-item .icon{width:20px;height:20px;background:currentColor;mask-size:contain;mask-repeat:no-repeat;mask-position:center;-webkit-mask-size:contain;-webkit-mask-repeat:no-repeat;-webkit-mask-position:center;}
        .icon-orders{mask-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-10-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM7 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>');}
        .icon-report{mask-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14h-4v-4h4v4zm0-6h-4V7h4v4zm5 6h-3v-4h3v4zm0-6h-3V7h3v4z"/></svg>');}
        .icon-logout{mask-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.59L17 17l5-5-5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>');}
        .user-section{margin-top:auto;padding:20px 16px;border-top:1px solid rgba(255,255,255,.1);display:flex;align-items:center;gap:12px;color:#a0aec0;font-size:14px;}
        .user-section .avatar{width:40px;height:40px;background:#4a90e2;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#fff;font-size:16px;}
        .header-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px;padding-bottom:15px;border-bottom:1px solid rgba(255,255,255,.1);flex-wrap:wrap;gap:10px;}
        .page-title{font-size:22px;font-weight:600;color:#e0e0e0;}
        .header-actions{display:flex;align-items:center;gap:10px;}
        .timer{background:rgba(74,144,226,.2);padding:6px 12px;border-radius:20px;font-size:13px;font-weight:600;color:#a0aec0;}
        .section{display:none;animation:fadeIn .4s ease;}
        .section.active{display:block;}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
        .card{background:rgba(15,32,39,.95);border-radius:16px;padding:20px;margin-bottom:20px;box-shadow:0 10px 25px rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.1);}
        .card-title{font-size:17px;color:#cbd5e0;display:flex;align-items:center;gap:8px;margin-bottom:15px;}
        .card-title::before{content:'';width:6px;height:6px;background:#4a90e2;border-radius:50%;}
        .order-item{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px dashed rgba(100,116,139,.3);font-size:13.5px;}
        .order-item:last-child{border-bottom:none;}
        .status-new{background:#ffc700;color:#000;padding:5px 12px;border-radius:20px;font-size:11px;font-weight:600;}
        .status-completed{color:#38a169;font-weight:600;}
        .btn-primary{background:#4a90e2;color:#fff;border:none;padding:10px 20px;border-radius:20px;font-weight:600;font-size:13px;cursor:pointer;transition:all .3s;box-shadow:0 4px 15px rgba(74,144,226,.3);}
        .btn-primary:hover{background:#357abd;transform:translateY(-2px);}
        .btn-download{background:#38a169;color:#fff;border:none;padding:10px 20px;border-radius:20px;font-weight:600;font-size:13px;cursor:pointer;transition:all .3s;box-shadow:0 4px 15px rgba(56,161,105,.3);margin:20px auto;display:block;}
        .btn-download:hover{background:#2f855a;transform:translateY(-2px);}
        .report-preview{background:rgba(45,55,72,.6);padding:20px;border-radius:12px;margin-top:15px;font-size:14px;line-height:1.6;}
        .report-header{text-align:center;margin-bottom:20px;}
        .report-title{font-size:18px;font-weight:700;color:#4a90e2;margin-bottom:8px;}
        .report-date{font-size:13px;color:#a0aec0;}
        .report-section{margin-bottom:20px;}
        .report-section-title{font-size:15px;font-weight:600;color:#cbd5e0;margin-bottom:10px;border-bottom:1px solid rgba(100,116,139,.3);padding-bottom:8px;}
        .report-row{display:flex;justify-content:space-between;margin-bottom:10px;}
        .report-label{color:#a0aec0;}
        .report-value{font-weight:600;}
        .report-comment{background:rgba(74,144,226,.15);padding:16px;border-radius:12px;margin-top:15px;border-left:4px solid #4a90e2;}
    </style>
</head>
<body>
    <div class="mobile-menu-btn" onclick="toggleSidebar()">☰</div>
    <div class="container">
        <aside class="sidebar" id="sidebar">
            <div class="logo">
                <img src="{% static 'images/logo.jpg' %}" alt="Логотип СаСЗМ" class="logo-img">
                <div>
                    <h1>СаСЗМ<br><span>Система слежения за металлом</span></h1>
                </div>
            </div>
            <nav class="nav-menu">
                <div class="nav-item active" data-page="orders"><div class="icon icon-orders"></div><span>Заказы</span></div>
                <div class="nav-item" data-page="reports"><div class="icon icon-report"></div><span>Сменные рапорты</span></div>
            </nav>
            <div class="user-section">
                <div class="avatar">{{ request.user.username|slice:":2"|upper }}</div>
                <div>
                    <div style="font-weight:600;color:#e0e0e0;">Руководство</div>
                    <div style="font-size:13px;color:#a0aec0;">{{ request.user.get_full_name|default:request.user.username }}</div>
                </div>
            </div>

            <!-- РАБОЧАЯ КНОПКА ВЫХОДА -->
            {% csrf_token %}
            <div class="nav-item" style="margin-top:15px;color:#feb2b2;cursor:pointer;" onclick="logout()">
                <div class="icon icon-logout"></div><span>Выход</span>
            </div>
        </aside>

        <main class="content">
            <!-- Заказы -->
            <div class="section active" id="orders">
                <header class="header-bar">
                    <h1 class="page-title">Заказы</h1>
                    <div class="header-actions"><div class="timer">Сегодня: {{ current_date }}</div></div>
                </header>

                <div class="card">
                    <div class="card-title">Новые заказы</div>
                    {% for order in new_orders %}
                        <div class="order-item">
                            <span>{{ order.internal_id|default:order.id }}</span>
                            <span class="status-new">Новый</span>
                            <button class="btn-primary" onclick="forwardOrder('{{ order.internal_id|default:order.id }}')">
                                Перенаправить
                            </button>
                        </div>
                    {% empty %}
                        <p style="color:#a0aec0;padding:15px 0;text-align:center;">Нет новых заказов</p>
                    {% endfor %}
                </div>

                <div class="card">
                    <div class="card-title">Завершённые заказы</div>
                    {% for order in completed_orders %}
                        <div class="order-item">
                            <span>{{ order.internal_id|default:order.id }}</span>
                            <span class="status-completed">Завершён</span>
                        </div>
                    {% empty %}
                        <p style="color:#a0aec0;padding:15px 0;text-align:center;">Нет завершённых заказов</p>
                    {% endfor %}
                </div>
            </div>

            <!-- Рапорты -->
            <div class="section" id="reports">
                <header class="header-bar">
                    <h1 class="page-title">Сменные рапорты</h1>
                    <div class="header-actions"><div class="timer">{{ current_date }}</div></div>
                </header>

                {% for report in reports %}
                    <div class="card">
                        <div class="card-title">Рапорт от {{ report.date|date:"d.m.Y" }} — {{ report.shift_type|default:"Дневная" }} смена</div>
                        <div class="report-preview">
                            <div class="report-header">
                                <div class="report-title">Сменный рапорт</div>
                                <div class="report-date">{{ report.date|date:"d декабря Y" }} — {{ report.shift_type|default:"Дневная" }} смена</div>
                            </div>
                            <div class="report-section">
                                <div class="report-section-title">Основные показатели</div>
                                <div class="report-row"><span class="report-label">Агрегат</span><span class="report-value">{{ report.aggregate|default:"Не указан" }}</span></div>
                                <div class="report-row"><span class="report-label">Произведено рулонов</span><span class="report-value">{{ report.rolls_produced|default:"0" }} шт.</span></div>
                                <div class="report-row"><span class="report-label">Брак</span><span class="report-value">{{ report.defect_percent|default:"0" }}%</span></div>
                                <div class="report-row"><span class="report-label">Простои</span><span class="report-value">{{ report.downtime_minutes|default:"0" }} мин</span></div>
                            </div>
                            <div class="report-section">
                                <div class="report-section-title">Комментарий оператора</div>
                                <div class="report-comment">
                                    {{ report.comment|default:"Без комментария"|linebreaksbr }}
                                </div>
                            </div>
                            <div style="text-align:center;">
                                <button class="btn-download" onclick="downloadReport('{{ report.id }}')">
                                    Скачать в PDF
                                </button>
                            </div>
                        </div>
                    </div>
                {% empty %}
                    <div class="card">
                        <p style="color:#a0aec0;text-align:center;padding:30px;">Рапорты отсутствуют</p>
                    </div>
                {% endfor %}
            </div>
        </main>
    </div>

    <script>
        document.querySelectorAll('.nav-item[data-page]').forEach(item => {
            item.addEventListener('click', () => {
                const page = item.getAttribute('data-page');
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
                document.getElementById(page).classList.add('active');
                if (window.innerWidth <= 992) document.getElementById('sidebar').classList.remove('open');
            });
        });

        function forwardOrder(orderId) {
            if (confirm(`Перенаправить заказ ${orderId} группе планирования?`)) {
                alert(`Заказ ${orderId} успешно перенаправлен`);
            }
        }

        function downloadReport(reportId) {
            alert('Рапорт скачан в PDF');
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // РАБОЧАЯ ФУНКЦИЯ ВЫХОДА
        function logout() {
            if (confirm('Выйти из системы?')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = "{% url 'logout' %}";

                const csrf = document.createElement('input');
                csrf.type = 'hidden';
                csrf.name = 'csrfmiddlewaretoken';
                csrf.value = document.querySelector('[name=csrfmiddlewaretoken]').value;

                form.appendChild(csrf);
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
</body>
</html>